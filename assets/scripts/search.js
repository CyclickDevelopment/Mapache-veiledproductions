/*!
 * mapache-veiledproductions v4.0.3
 * Copyright 2023 Cyclic Development <pete@cyclick-development.co.uk> (https://github.com/cyclicdevelopment/mapache-veiledproductions)
 * Licensed under gpl-3.0
 */!function s(n,r,o){function h(e,t){if(!r[e]){if(!n[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(a)return a(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}i=r[e]={exports:{}},n[e][0].call(i.exports,function(t){return h(n[e][1][t]||t)},i,i.exports,s,n,r,o)}return r[e].exports}for(var a="function"==typeof require&&require,t=0;t<o.length;t++)h(o[t]);return h}({1:[function(t,e,i){e.exports=function(t){return t&&t.__esModule?t:{default:t}},e.exports.__esModule=!0,e.exports.default=e.exports},{}],2:[function(t,e,i){"use strict";{var s="FlexSearch",n=function c(l){function f(t,e){var i=e?e.id:t&&t.id;this.id=i||0===i?i:n++,this.init(t,e),s(this,"index",function(){return this.a?Object.keys(this.a.index[this.a.keys[0]].c):Object.keys(this.c)}),s(this,"length",function(){return this.index.length})}function u(t,e,i,s){return this.u!==this.g&&(this.o=this.o.concat(i),this.u++,s&&this.o.length>=s&&(this.u=this.g),this.u===this.g)&&(this.cache&&this.j.set(e,this.o),this.F)&&this.F(this.o),this}function O(i,s){var n=i.length,r=_(s),o=[];for(let t=0,e=0;t<n;t++){var h=i[t];(r&&s(h)||!r&&!s[h])&&(o[e++]=h)}return o}function E(t,e,i,s,n,r,o,h,a,c){i=L(i,o?0:n,h,r,e,a,c);let l;if(h&&(h=i.page,l=i.next,i=i.result),o)e=this.where(o,null,n,i);else{for(e=i,i=this.l,n=e.length,r=Array(n),o=0;o<n;o++)r[o]=i[e[o]];e=r}return i=e,s&&(_(s)||(s=1<(q=s.split(":")).length?g:(q=q[0],d)),i.sort(s)),i=D(h,l,i),this.cache&&this.j.set(t,i),i}function s(t,e,i){Object.defineProperty(t,e,{get:i})}function b(t){return new RegExp(t,"g")}function x(e,i){for(let t=0;t<i.length;t+=2)e=e.replace(i[t],i[t+1]);return e}function w(t,e,i,s,n,r,o,h){return e[i]||(o<=(e[i]=n=n?(h-(o||h/1.5))*r+(o||h/1.5)*n:r)&&((t=(t=t[h-(n+.5>>0)])[i]||(t[i]=[]))[t.length]=s),n)}function h(i,s){if(i){var n=Object.keys(i);for(let t=0,e=n.length;t<e;t++){var r=n[t],o=i[r];if(o)for(let t=0,e=o.length;t<e;t++){if(o[t]===s){1===e?delete i[r]:o.splice(t,1);break}C(o[t])&&h(o[t],s)}}}}function k(e){let i="",s="";var n="";for(let t=0;t<e.length;t++){var r=e[t];r===s||t&&"h"===r&&(n="a"===n||"e"===n||"i"===n||"o"===n||"u"===n||"y"===n,"a"!==s&&"e"!==s&&"i"!==s&&"o"!==s&&"u"!==s&&"y"!==s||!n)&&" "!==s||(i+=r),n=t===e.length-1?"":e[t+1],s=r}return i}function I(t,e){return(t=t.length-e.length)<0?1:t?-1:0}function d(t,e){return(t=t[q])<(e=e[q])?-1:e<t?1:0}function g(e,i){var s=q.length;for(let t=0;t<s;t++)e=e[q[t]],i=i[q[t]];return e<i?-1:i<e?1:0}function D(t,e,i){return t?{page:t,next:e?""+e:null,result:i}:i}function L(l,f,u,d,g,p,m){let v,y=[];var b=!0===u?(u="0",""):u&&u.split(":"),x=l.length;if(1<x){var w=P(),k=[];let t,e;var S=0;let i;var O=!0;let s,n=0,r,o,h,a;if(b=b&&(2===b.length?(h=b,!1):a=parseInt(b[0],10)),m){for(t=P();S<x;S++)if("not"===g[S])for(e=l[S],i=e.length,L=0;L<i;L++)t["@"+e[L]]=1;else o=S+1;if(A(o))return D(u,v,y);S=0}else r=F(g)&&g;let c;for(;S<x;S++){var E=S===(o||x)-1;if(!r||!S)if((L=r||g&&g[S])&&"and"!==L){if("or"!==L)continue;c=!1}else c=p=!0;if(e=l[S],i=e.length){if(O){if(!s){s=e;continue}for(var I=s.length,L=0;L<I;L++){var j="@"+(O=s[L]);m&&t[j]||(w[j]=1,p)||(y[n++]=O)}s=null,O=!1}for(j=!1,L=0;L<i;L++){var _="@"+(I=e[L]),C=p?w[_]||0:S;if(!(!C&&!d||m&&t[_]||!p&&w[_]))if(C===S){if(E){if((!a||--a<n)&&(y[n++]=I,f)&&n===f)return D(u,n+(b||0),y)}else w[_]=S+1;j=!0}else d&&((_=k[C]||(k[C]=[]))[_.length]=I)}if(c&&!j&&!d)break}else if(c&&!d)return D(u,v,e)}if(s)if(S=s.length,m)for(L=b?parseInt(b,10):0;L<S;L++)l=s[L],t["@"+l]||(y[n++]=l);else y=s;if(d)for(n=y.length,L=h?(S=parseInt(h[0],10)+1,parseInt(h[1],10)+1):(S=k.length,0);S--;)if(I=k[S]){for(i=I.length;L<i;L++)if(d=I[L],(!m||!t["@"+d])&&(y[n++]=d,f)&&n===f)return D(u,S+":"+L,y);L=0}}else!x||g&&"not"===g[0]||(y=l[0],b=b&&parseInt(b[0],10));return f&&(m=y.length,b=(b=b&&m<b?0:b)||0,(v=b+f)<m?y=y.slice(b,v):(v=0,b&&(y=y.slice(b)))),D(u,v,y)}function F(t){return"string"==typeof t}function j(t){return t.constructor===Array}function _(t){return"function"==typeof t}function C(t){return"object"==typeof t}function A(t){return void 0===t}function S(e){var i=Array(e);for(let t=0;t<e;t++)i[t]=P();return i}function P(){return Object.create(null)}function p(){let i,s;self.onmessage=function(t){var e;(t=t.data)&&(t.search?(e=s.search(t.content,t.threshold?{limit:t.limit,threshold:t.threshold,where:t.where}:t.limit),self.postMessage({id:i,content:t.content,limit:t.limit,result:e})):t.add?s.add(t.id,t.content):t.update?s.update(t.id,t.content):t.remove?s.remove(t.id):t.clear?s.clear():t.info?((t=s.info()).worker=i,console.log(t)):t.register&&(i=t.id,t.options.cache=!1,t.options.async=!1,t.options.worker=!1,s=new(s=new Function(t.register.substring(t.register.indexOf("{")+1,t.register.lastIndexOf("}")))())(t.options)))}}const m={encode:"icase",f:"forward",split:/\W+/,cache:!1,async:!1,g:!1,D:!1,a:!1,b:9,threshold:0,depth:0},v={memory:{encode:"extra",f:"strict",threshold:0,b:1},speed:{encode:"icase",f:"strict",threshold:1,b:3,depth:2},match:{encode:"extra",f:"full",threshold:1,b:3},score:{encode:"extra",f:"strict",threshold:1,b:9,depth:4},balance:{encode:"balance",f:"strict",threshold:0,b:3,depth:3},fast:{encode:"icase",f:"strict",threshold:8,b:9,depth:1}},i=[];let n=0;const y={},M={};f.create=function(t,e){return new f(t,e)},f.registerMatcher=function(t){for(const e in t)t.hasOwnProperty(e)&&i.push(b(e),t[e]);return this},f.registerEncoder=function(t,e){return B[t]=e.bind(B),this},f.registerLanguage=function(t,e){return y[t]=e.filter,M[t]=e.stemmer,this},f.encode=function(t,e){return B[t](e)},f.prototype.init=function(e,i){var t,s;if(this.v=[],i?(t=i.preset,e=i):t=(e=e||m).preset,i={},F(e)?(i=v[e],e={}):t&&(i=v[t]),t=e.worker)if("undefined"==typeof Worker)e.worker=!1,this.m=null;else{var n=parseInt(t,10)||4;this.C=-1,this.u=0,this.o=[],this.F=null,this.m=Array(n);for(var r=0;r<n;r++)this.m[r]=function(t,e,i,s){t=l("flexsearch","id"+t,p,function(t){(t=t.data)&&t.result&&s(t.id,t.content,t.result,t.limit,t.where,t.cursor,t.suggest)},e);var n=c.toString();return i.id=e,t.postMessage({register:n,options:i,id:e}),t}(this.id,r,e,u.bind(this))}if(this.f=e.tokenize||i.f||this.f||m.f,this.split=A(t=e.split)?this.split||m.split:F(t)?b(t):t,this.D=e.rtl||this.D||m.D,this.async="undefined"==typeof Promise||A(t=e.async)?this.async||m.async:t,this.g=A(t=e.worker)?this.g||m.g:t,this.threshold=A(t=e.threshold)?i.threshold||this.threshold||m.threshold:t,this.b=A(t=e.resolution)?t=i.b||this.b||m.b:t,t<=this.threshold&&(this.b=this.threshold+1),this.depth="strict"!==this.f||A(t=e.depth)?i.depth||this.depth||m.depth:t,this.w=(t=A(t=e.encode)?i.encode||m.encode:t)&&B[t]&&B[t].bind(B)||(_(t)?t:this.w||!1),(t=e.matcher)&&this.addMatcher(t),t=(i=e.lang)||e.filter){if(j(t=F(t)?y[t]:t)){for(var n=this.w,r=P(),o=0;o<t.length;o++){var h=n?n(t[o]):t[o];r[h]=1}t=r}this.filter=t}if(t=i||e.stemmer){for(s in i=F(t)?M[t]:t,n=this.w,r=[],i)i.hasOwnProperty(s)&&(o=n?n(s):s,r.push(b(o+"($|\\W)"),n?n(i[s]):i[s]));this.stemmer=s=r}if(this.a=r=(t=e.doc)?function t(e){var i,s=P();for(const n in e)e.hasOwnProperty(n)&&(j(i=e[n])?s[n]=i.slice(0):C(i)?s[n]=t(i):s[n]=i);return s}(t):this.a||m.a,this.i=S(this.b-(this.threshold||0)),this.h=P(),this.c=P(),r){if(this.l=P(),e.doc=null,s=r.index={},i=r.keys=[],n=r.field,o=r.tag,h=r.store,j(r.id)||(r.id=r.id.split(":")),h){var a=P();if(F(h))a[h]=1;else if(j(h))for(let t=0;t<h.length;t++)a[h[t]]=1;else C(h)&&(a=h);r.store=a}if(o){if(this.G=P(),h=P(),n)if(F(n))h[n]=e;else if(j(n))for(a=0;a<n.length;a++)h[n[a]]=e;else C(n)&&(h=n);for(j(o)||(r.tag=o=[o]),n=0;n<o.length;n++)this.G[o[n]]=P();this.I=o,n=h}if(n){let t;for(j(n)||(C(n)?(t=n,r.field=n=Object.keys(n)):r.field=n=[n]),r=0;r<n.length;r++)j(o=n[r])||(t&&(e=t[o]),i[r]=o,n[r]=o.split(":")),s[o]=new f(e)}e.doc=t}return this.B=!0,this.j=!!(this.cache=t=A(t=e.cache)?this.cache||m.cache:t)&&new U(t),this},f.prototype.encode=function(t){return t=t&&(i.length&&(t=x(t,i)),this.v.length&&(t=x(t,this.v)),this.w&&(t=this.w(t)),this.stemmer)?x(t,this.stemmer):t},f.prototype.addMatcher=function(t){var e=this.v;for(const i in t)t.hasOwnProperty(i)&&e.push(b(i),t[i]);return this},f.prototype.add=function(i,s,n,r,e){if(this.a&&C(i))return this.A("add",i,s);if(s&&F(s)&&(i||0===i)){var t="@"+i;if(this.c[t]&&!r)return this.update(i,s);if(this.g)return++this.C>=this.m.length&&(this.C=0),this.m[this.C].postMessage({add:!0,id:i,content:s}),this.c[t]=""+this.C,n&&n(),this;if(!e){if(this.async&&"function"!=typeof importScripts){let e=this;return(t=new Promise(function(t){setTimeout(function(){e.add(i,s,null,r,!0),e=null,t()})}),n)?(t.then(n),this):t}if(n)return this.add(i,s,null,r,!0),n(),this}if(!(s=this.encode(s)).length)return this;e=_(n=this.f)?n(s):s.split(this.split),this.filter&&(e=O(e,this.filter));var o=P(),h=(o._ctx=P(),e.length),a=this.threshold,c=this.depth,l=this.b,f=this.i,u=this.D;for(let t=0;t<h;t++){var d=e[t];if(d){var g=d.length,p=(u?t+1:h-t)/h,m="";switch(n){case"reverse":case"both":for(var v=g;--v;)w(f,o,m=d[v]+m,i,u?1:(g-v)/g,p,a,l-1);m="";case"forward":for(v=0;v<g;v++)w(f,o,m+=d[v],i,u?(v+1)/g:1,p,a,l-1);break;case"full":for(v=0;v<g;v++){var y=(u?v+1:g-v)/g;for(let t=g;t>v;t--)w(f,o,m=d.substring(v,t),i,y,p,a,l-1)}break;default:if(g=w(f,o,d,i,1,p,a,l-1),c&&1<h&&a<=g)for(g=o._ctx[d]||(o._ctx[d]=P()),d=this.h[d]||(this.h[d]=S(l-(a||0))),(p=t-c)<0&&(p=0),h<(m=t+c+1)&&(m=h);p<m;p++)p!==t&&w(d,g,e[p],i,0,l-(p<t?t-p:p-t),a,l-1)}}}this.c[t]=1,this.B=!1}return this},f.prototype.A=function(i,s,n){if(j(s)){var r=s.length;if(r--){for(var t=0;t<r;t++)this.A(i,s[t]);return this.A(i,s[r],n)}}else{for(var e,o=this.a.index,h=this.a.keys,a=this.a.tag,t=this.a.store,c=this.a.id,r=s,l=0;l<c.length;l++)r=r[c[l]];if("remove"===i&&(delete this.l[r],c=h.length,c--)){for(s=0;s<c;s++)o[h[s]].remove(r);return o[h[c]].remove(r,n)}if(a){for(e=0;e<a.length;e++){for(var f=a[e],u=s,c=f.split(":"),l=0;l<c.length;l++)u=u[c[l]];u="@"+u}e=(e=this.G[f])[u]||(e[u]=[])}for(let t=0,e=(c=this.a.field).length;t<e;t++){for(f=c[t],a=s,u=0;u<f.length;u++)a=a[f[u]];f=o[h[t]],u="add"===i?f.add:f.update,t===e-1?u.call(f,r,a,n):u.call(f,r,a)}if(t){for(n=Object.keys(t),i=P(),o=0;o<n.length;o++)if(t[h=n[o]]){h=h.split(":");let t,e;for(c=0;c<h.length;c++)a=h[c],t=(t||s)[a],e=(e||i)[a]=t}s=i}e&&(e[e.length]=s),this.l[r]=s}return this},f.prototype.update=function(t,e,i){return this.a&&C(t)?this.A("update",t,e):(this.c["@"+t]&&F(e)&&(this.remove(t),this.add(t,e,i,!0)),this)},f.prototype.remove=function(i,t,e){if(this.a&&C(i))return this.A("remove",i,t);var s="@"+i;if(this.c[s]){if(this.g)return this.m[this.c[s]].postMessage({remove:!0,id:i}),delete this.c[s],t&&t(),this;if(!e){if(this.async&&"function"!=typeof importScripts){let e=this;return(s=new Promise(function(t){setTimeout(function(){e.remove(i,null,!0),e=null,t()})}),t)?(s.then(t),this):s}if(t)return this.remove(i,null,!0),t(),this}for(t=0;t<this.b-(this.threshold||0);t++)h(this.i[t],i);this.depth&&h(this.h,i),delete this.c[s],this.B=!1}return this};let q;f.prototype.search=function(r,o,t,h){if(C(o)){if(j(o))for(var a=0;a<o.length;a++)o[a].query=r;else o.query=r;r=o,o=1e3}else o&&_(o)?(t=o,o=1e3):o||0===o||(o=1e3);if(!this.g){var c,l,f,u=[],d=r;if(C(r)&&!j(r)&&(t||(t=r.callback)&&(d.callback=null),c=r.sort,l=r.page,o=r.limit,w=r.threshold,f=r.suggest,r=r.query),this.a){w=this.a.index;const k=d.where;var g=d.bool||"or",p=d.field;let i=g,s,n;if(p)j(p)||(p=[p]);else if(j(d)){var e=d,p=[];i=[];for(var m=0;m<d.length;m++)a=(h=d[m]).bool||g,p[m]=h.field,"not"===(i[m]=a)?s=!0:"and"===a&&(n=!0)}else p=this.a.keys;for(g=p.length,m=0;m<g;m++)e&&(d=e[m]),l&&!F(d)&&(d.page=null,d.limit=0),u[m]=w[p[m]].search(d,0);if(t)return t(E.call(this,r,i,u,c,o,f,k,l,n,s));if(this.async){const S=this;return new Promise(function(e){Promise.all(u).then(function(t){e(E.call(S,r,i,t,c,o,f,k,l,n,s))})})}return E.call(this,r,i,u,c,o,f,k,l,n,s)}if(w=w||this.threshold||0,!h){if(this.async&&"function"!=typeof importScripts){let e=this;return(w=new Promise(function(t){setTimeout(function(){t(e.search(d,o,null,!0)),e=null})}),t)?(w.then(t),this):w}if(t)return t(this.search(d,o,null,!0)),this}if(r&&F(r)){if(d=r,this.cache)if(this.B){if(t=this.j.get(r))return t}else this.j.clear(),this.B=!0;if((d=this.encode(d)).length){t=_(t=this.f)?t(d):d.split(this.split),e=(t=this.filter?O(t,this.filter):t).length,h=!0;var a=[],n=P(),i=0;if(1<e&&(this.depth&&"strict"===this.f?g=!0:t.sort(I)),!g||(m=this.h))for(var v=this.b;i<e;i++){let s=t[i];if(s){if(g){if(!p)if(m[s])n[p=s]=1;else if(!f)return u;if(f&&i===e-1&&!a.length)g=!1,n[s=p||s]=0;else if(!p)continue}if(!n[s]){var y=[];let e=!1,i=0;var b,x=g?m[p]:this.i;if(x)for(let t=0;t<v-w;t++)(b=x[t]&&x[t][s])&&(y[i++]=b,e=!0);if(e)p=s,a[a.length]=1<i?y.concat.apply([],y):y[0];else if(!f){h=!1;break}n[s]=1}}}else h=!1;h&&(u=L(a,o,l,f)),this.cache&&this.j.set(r,u)}}return u}this.F=t,this.u=0,this.o=[];for(var w=0;w<this.g;w++)this.m[w].postMessage({search:!0,limit:o,content:r})},f.prototype.find=function(t,e){return this.where(t,e,1)[0]||null},f.prototype.where=function(s,n,t,e){var r,o=this.l,h=[];let a=0,c,l;if(C(s)){t=t||n;var f=Object.keys(s),u=f.length;if(c=!1,1===u&&"id"===f[0])return[o[s.id]];if((r=this.I)&&!e)for(var i=0;i<r.length;i++){var d=r[i],g=s[d];if(!A(g)){if(l=this.G[d]["@"+g],0==--u)return l;f.splice(f.indexOf(d),1),delete s[d];break}}for(r=Array(u),i=0;i<u;i++)r[i]=f[i].split(":")}else{if(_(s)){for(t=(n=e||Object.keys(o)).length,f=0;f<t;f++)s(u=o[n[f]])&&(h[a++]=u);return h}if(A(n))return[o[s]];if("id"===s)return[o[n]];f=[s],u=1,r=[s.split(":")],c=!0}for(i=(e=l||e||Object.keys(o)).length,d=0;d<i;d++){g=l?e[d]:o[e[d]];let i=!0;for(let t=0;t<u;t++){c||(n=s[f[t]]);var p=r[t],m=p.length;let e=g;if(1<m)for(let t=0;t<m;t++)e=e[p[t]];else e=e[p[0]];if(e!==n){i=!1;break}}if(i&&(h[a++]=g,t)&&a===t)break}return h},f.prototype.info=function(){if(!this.g)return{id:this.id,items:this.length,cache:!(!this.cache||!this.cache.s)&&this.cache.s.length,matcher:i.length+(this.v?this.v.length:0),worker:this.g,threshold:this.threshold,depth:this.depth,resolution:this.b,contextual:this.depth&&"strict"===this.f};for(let t=0;t<this.g;t++)this.m[t].postMessage({info:!0,id:this.id})},f.prototype.clear=function(){return this.destroy().init()},f.prototype.destroy=function(){if(this.cache&&(this.j.clear(),this.j=null),this.i=this.h=this.c=null,this.a){var e=this.a.keys;for(let t=0;t<e.length;t++)this.a.index[e[t]].destroy();this.a=this.l=null}return this},f.prototype.export=function(e){var t=!e||A(e.serialize)||e.serialize;if(this.a){var i=!e||A(e.doc)||e.doc,s=!e||A(e.index)||e.index;e=[];let t=0;if(s)for(s=this.a.keys;t<s.length;t++){var n=this.a.index[s[t]];e[t]=[n.i,n.h,Object.keys(n.c)]}i&&(e[t]=this.l)}else e=[this.i,this.h,Object.keys(this.c)];return e=t?JSON.stringify(e):e},f.prototype.import=function(t,e){e&&!A(e.serialize)&&!e.serialize||(t=JSON.parse(t));var i=P();if(this.a){var s=!e||A(e.doc)||e.doc,n=0;if(!e||A(e.index)||e.index){for(var r=(e=this.a.keys).length,o=t[0][2];n<o.length;n++)i[o[n]]=1;for(n=0;n<r;n++){var o=this.a.index[e[n]],h=t[n];h&&(o.i=h[0],o.h=h[1],o.c=i)}}s&&(this.l=C(s)?s:t[n])}else{for(s=t[2],n=0;n<s.length;n++)i[s[n]]=1;this.i=t[0],this.h=t[1],this.c=i}};const t=function(){const t=b("\\s+"),e=b("[^a-z0-9 ]"),i=[b("[-/]")," ",e,"",t," "];return function(t){return k(x(t.toLowerCase(),i))}}(),B={icase:function(t){return t.toLowerCase()},simple:function(){const t=b("\\s+"),e=b("[^a-z0-9 ]"),i=b("[-/]"),s=b("[àáâãäå]"),n=b("[èéêë]"),r=b("[ìíîï]"),o=b("[òóôõöő]"),h=b("[ùúûüű]"),a=b("[ýŷÿ]"),c=b("ñ"),l=b("[çc]"),f=b("ß"),u=b(" & "),d=[s,"a",n,"e",r,"i",o,"o",h,"u",a,"y",c,"n",l,"k",f,"s",u," and ",i," ",e,"",t," "];return function(t){return" "===(t=x(t.toLowerCase(),d))?"":t}}(),advanced:function(){const t=b("ae"),e=b("ai"),i=b("ay"),s=b("ey"),n=b("oe"),r=b("ue"),o=b("ie"),h=b("sz"),a=b("zs"),c=b("ck"),l=b("cc"),f=b("sh"),u=b("th"),d=b("dt"),g=b("ph"),p=b("pf"),m=b("ou"),v=b("uo"),y=[t,"a",e,"ei",i,"ei",s,"ei",n,"o",r,"u",o,"i",h,"s",a,"s",f,"s",c,"k",l,"k",u,"t",d,"t",g,"f",p,"f",m,"o",v,"u"];return function(t,e){return t&&(2<(t=this.simple(t)).length&&(t=x(t,y)),e||1<t.length&&(t=k(t))),t}}(),extra:function(){const t=b("p"),e=b("z"),i=b("[cgq]"),s=b("n"),n=b("d"),r=b("[vw]"),o=b("[aeiouy]"),h=[t,"b",e,"s",i,"k",s,"m",n,"t",r,"f",o,""];return function(e){if(e&&1<(e=this.advanced(e,!0)).length){e=e.split(" ");for(let t=0;t<e.length;t++){var i=e[t];1<i.length&&(e[t]=i[0]+x(i.substring(1),h))}e=k(e=e.join(" "))}return e}}(),balance:t},U=(e.prototype.clear=function(){this.cache=P(),this.count=P(),this.index=P(),this.s=[]},e.prototype.set=function(e,i){if(this.H&&A(this.cache[e])){let t=this.s.length;var s;t===this.H&&(t--,s=this.s[t],delete this.cache[s],delete this.count[s],delete this.index[s]),this.index[e]=t,this.s[t]=e,this.count[e]=-1,this.cache[e]=i,this.get(e)}else this.cache[e]=i},e.prototype.get=function(e){var t=this.cache[e];if(this.H&&t){var i=++this.count[e],s=this.index;let t=s[e];if(0<t){for(var n=this.s,r=t;this.count[n[--t]]<=i&&-1!==t;);if(++t!==r){for(i=r;i>t;i--)r=n[i-1],s[n[i]=r]=i;s[n[t]=e]=t}}}return t},e);function e(t){this.clear(),this.H=!0!==t&&t}return f}(function(){const r={},o="undefined"!=typeof Blob&&"undefined"!=typeof URL&&URL.createObjectURL;return function(t,e,i,s,n){return i=o?URL.createObjectURL(new Blob(["("+i.toString()+")()"],{type:"text/javascript"})):t+".min.js",t+="-"+e,r[t]||(r[t]=[]),r[t][n]=new Worker(i),r[t][n].onmessage=s,r[t][n]}}()),r=this;let t;(t=r.define)&&t.amd?t([],function(){return n}):(t=r.modules)?t[s.toLowerCase()]=n:"object"==typeof i?e.exports=n:r[s]=n}},{}],3:[function(t,e,i){"use strict";var s=t("@babel/runtime/helpers/interopRequireDefault"),n=(Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0,s(t("flexsearch")));i.default=class{constructor(t){this.config={url:window.location.origin,key:"",version:"v4",loadOn:"focus",searchOn:"keyup",limit:10,inputId:["search-bar"],outputId:["search-results"],outputChildsType:"li",postsFields:["title","url","published_at"],postsExtraFields:[],postsFormats:[],indexedFields:["title"],template:function(t){},emptyTemplate:function(){},customProcessing:function(t){return t.tags&&(t.string_tags=t.tags.map(t=>t.name).join(" ").toLowerCase()),t},date:{locale:document.documentElement.lang||"en-US",options:{year:"numeric",month:"short",day:"numeric"}},cacheMaxAge:1800,onFetchStart:function(){},onFetchEnd:function(t){},onIndexBuildStart:function(){},onIndexBuildEnd:function(t){},onSearchStart:function(){},onSearchEnd:function(t){},indexOptions:{},searchOptions:{},debug:!1},this.dataLoaded=!1,this.postsCount=0,this.storage=this.getLocalStorageOption(),this.initConfig(t),this.triggerDataLoad()}initConfig(t){for(var[e,i]of Object.entries(t))this.config[e]=i;Array.isArray(this.config.inputId)||(this.config.inputId=[this.config.inputId]),Array.isArray(this.config.outputId)||(this.config.outputId=[this.config.outputId]),this.config.searchOptions.limit=this.config.limit,this.originalPostsFields=this.config.postsFields,this.config.postsFields.includes("updated_at")||this.config.postsFields.push("updated_at"),this.config.inputId&&0<this.config.inputId.length&&(this.searchBarEls=[],this.config.inputId.forEach(t=>{var e=document.getElementById(t);e?(this.searchBarEls.push(e),this.addSearchListeners(e)):this.error(`Enable to find the input element #${t}, please check your configuration`)})),this.config.outputId&&0<this.config.outputId.length&&(this.searchResultEls=[],this.config.outputId.forEach(t=>{var e=document.getElementById(t);e?this.searchResultEls.push(e):this.error(`Enable to find the output element #${t}, please check your configuration`)})),this.index=this.getNewSearchIndex()}addSearchListeners(e){var t=e.closest("form");switch(t&&t.addEventListener("submit",t=>{t.preventDefault()}),this.config.searchOn){case"keyup":e.addEventListener("keyup",()=>{var t=e.value.toLowerCase();this.search(t)});break;case"submit":t.addEventListener("submit",()=>{var t=e.value.toLowerCase();this.search(t)});break;case!1:case"none":break;default:this.error(`Unknown 'searchOn' option: '${this.config.searchOn}'`)}}triggerDataLoad(){switch(this.config.loadOn){case"focus":this.searchBarEls.forEach(t=>{t.addEventListener("focus",()=>{this.loadData()})});break;case"page":window.addEventListener("load",()=>{this.loadData()});break;case!1:case"none":break;default:this.error(`Unknown 'loadOn' option: '${this.config.loadOn}'`)}}loadData(){var t;this.dataLoaded||(this.storage?(t=this.storage.getItem("SearchinGhost_index"))?(this.log("Found an index stored locally, loads it"),this.config.onIndexBuildStart(),this.index.import(t),this.dataLoaded=!0,this.config.onIndexBuildEnd(this.index),this.validateCache()):(this.log("No already stored index found"),this.fetch()):(this.log("No local storage available, switch to degraded mode"),this.fetch()))}validateCache(){var t=this.storage.getItem("SearchinGhost_cache_info");if(t){const i=JSON.parse(t);var t=new Date(i.lastCacheCheck),t=Math.round((new Date-t)/1e3);t<this.config.cacheMaxAge?this.log(`Skip cache refreshing, updated less than ${this.config.cacheMaxAge}s ago (${t}s)`):(t=this.buildUrl({limit:1,fields:["updated_at"],order:"updated_at DESC"}),fetch(t).then(function(t){return t.json()}).then(t=>{var e=t.posts[0].updated_at,t=t.meta.pagination.total;e!==i.lastestPostUpdatedAt?(this.log("Posts update found, purge outdated local cache"),this.fetch()):t<i.totalPosts?(this.log("Deleted or unpublished posts found, purge outdated local cache"),this.fetch()):(this.log("Local cached data up to date"),i.lastCacheCheck=(new Date).toISOString(),this.storage.setItem("SearchinGhost_cache_info",JSON.stringify(i)))}).catch(t=>{console.error("Unable to fetch the latest post information to check cache state",t)}))}else this.log("No cache info local object found"),this.fetch()}fetch(){this.log("Fetching data from Ghost API"),this.config.onFetchStart();var t={limit:"all",fields:this.config.postsFields,order:"updated_at DESC"},t=(0<this.config.postsExtraFields.length&&(t.include=this.config.postsExtraFields),0<this.config.postsFormats.length&&(t.formats=this.config.postsFormats),this.buildUrl(t));fetch(t).then(function(t){return t.json()}).then(t=>{var e=t.posts;this.config.onFetchEnd(e),this.config.onIndexBuildStart(),this.index=this.getNewSearchIndex(),e.forEach(t=>{t=this.format(t);t&&this.index.add(t)}),this.dataLoaded=!0,this.config.onIndexBuildEnd(this.index),this.storage&&(e={lastCacheCheck:(new Date).toISOString(),lastestPostUpdatedAt:e[0].updated_at,totalPosts:t.meta.pagination.total},this.storage.setItem("SearchinGhost_index",this.index.export()),this.storage.setItem("SearchinGhost_cache_info",JSON.stringify(e))),this.log("Search index build complete")}).catch(t=>{this.error("Unable to fetch Ghost data.\n",t)})}format(t){return t.id=this.postsCount++,t.published_at=this.prettyDate(t.published_at),this.originalPostsFields.includes("updated_at")||delete t.updated_at,t.custom_excerpt&&(t.excerpt=t.custom_excerpt,delete t.custom_excerpt),t=this.config.customProcessing(t)}search(t){this.loadData(),this.config.onSearchStart();t=this.index.search(t,this.config.searchOptions);return this.searchResultEls&&0<this.searchResultEls.length&&this.display(t),this.config.onSearchEnd(t),t}display(t){this.searchResultEls.forEach(t=>{t.innerHTML=""}),t.length<1?this.insertTemplate(this.config.emptyTemplate()):t.forEach(t=>{this.insertTemplate(this.config.template(t))})}insertTemplate(i){i&&this.searchResultEls.forEach(t=>{var e;this.config.outputChildsType?((e=document.createElement(this.config.outputChildsType)).classList.add(t.id+"-item"),e.innerHTML=i,t.appendChild(e)):t.insertAdjacentHTML("beforeend",i)})}getNewSearchIndex(){var t,e,i={doc:{id:"id",field:this.config.indexedFields},encode:"simple",tokenize:"forward",threshold:0,resolution:4,depth:0};for([t,e]of Object.entries(this.config.indexOptions))i[t]=e;return new n.default(i)}buildUrl(t){let e=`${this.config.url}/ghost/api/${this.config.version}/content/posts/?key=`+this.config.key;for(var[i,s]of Object.entries(t))e+=`&${i}=`+s;return encodeURI(e)}prettyDate(t){return new Date(t).toLocaleDateString(this.config.date.locale,this.config.date.options)}getLocalStorageOption(){try{return window.localStorage.setItem("storage-availability-test",""),window.localStorage.removeItem("storage-availability-test"),window.localStorage}catch(t){}}log(t,e){this.config.debug&&(e?console.log(t,e):console.log(t))}error(t,e){e?console.error(t,e):console.error(t)}}},{"@babel/runtime/helpers/interopRequireDefault":1,flexsearch:2}],4:[function(e,t,i){"use strict";e=e("@babel/runtime/helpers/interopRequireDefault")(e("./lib/searchinghost"));{var n=document;const l=n.body,f=n.querySelector(".js-search"),u=n.querySelector("#search-bar"),d=n.querySelector("#search-results"),g="is-active";let s=0;const p=(()=>{try{return window.localStorage.setItem("storage-mapache-test",""),window.localStorage.removeItem("storage-mapache-test"),window.localStorage}catch(t){}})(),m=t=>`<a class="block noWrapWithEllipsis px-4 py-2" href="${t.url}"><svg class="icon is-x-small mr-2"><use xlink:href="#icon-search"></use></svg> <span>${void 0===t.name?t.title:t.name}</span></a>`;var r={key:searchSettings.key,template:t=>m(t),onSearchEnd:function(t){s=t.length,o();t=JSON.parse(localStorage.getItem("mapache_tags"));""===u.value&&t&&v(t)}};function o(t){t=t||0;var e=d.querySelectorAll("li");e.length&&(e.forEach(t=>t.classList.remove(g)),e[t].classList.add(g))}function h(t){var e=t.keyCode;if(27===e)y();else if(13===e)u.blur(),(i=d.querySelector("li."+g))&&i.firstChild.click();else if(38===e||40===e){{var i=e;let t=0;e=d.querySelector("li."+g);e&&(t=[].slice.call(e.parentNode.children).indexOf(e)),u.blur(),38===i?t<=0?(u.focus(),t=0):--t:t>=s-1?t=0:t+=1,o(t)}t.preventDefault()}}const v=t=>{s=t.length,t.forEach(t=>{var e=n.createElement("li"),t=m(t);e.innerHTML=t,d.appendChild(e)}),o()};var a,c=n.querySelectorAll(".js-toggle-search");let t=!1;const y=()=>{t=t?(f.classList.add("hidden"),l.removeEventListener("keydown",h),!1):(f.classList.remove("hidden"),l.addEventListener("keydown",h),u.focus(),!0)};c.forEach(t=>t.addEventListener("click",function(t){t.preventDefault(),y()})),c=`${void 0===searchSettings.url?window.location.origin:searchSettings.url}/ghost/api/v4/content/tags/?key=${searchSettings.key}&filter=visibility:public&limit=10`,(a=localStorage.getItem("mapache_tags"))?v(JSON.parse(a)):(async t=>{return await(await fetch(t)).json()})(c).then(t=>{if(v(t.tags),!p)return!1;localStorage.setItem("mapache_tags",JSON.stringify(t.tags))}).catch(t=>console.error(t)),new e.default(r)}},{"./lib/searchinghost":3,"@babel/runtime/helpers/interopRequireDefault":1}]},{},[4]);